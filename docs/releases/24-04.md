
# 24.04

[Nextflow 24.04](https://github.com/nextflow-io/nextflow/releases/tag/v24.04.0) was released on May 20, 2024.

## New features

### Topic channels (first preview)

A topic channel is a queue channel that can receive values from multiple sources based on a matching name or "topic":

```nextflow
process foo {
  output:
  val('foo'), topic: 'my-topic'
}

process bar {
  output:
  val('bar'), topic: 'my-topic'
}

workflow {
  foo()
  bar()

  Channel.topic('my-topic').view()
}
```

Topic channels are particularly useful for collecting metadata from various places in the pipeline, without needing to write all of the channel logic that is normally required (e.g. using the `mix` operator).

See {ref}`channel-topic` for details.

### `eval` outputs

A process `eval` output is a new type of process output which allows you to capture the standard output of an arbitrary shell command:

```nextflow
process sayHello {
  output:
  eval('bash --version')

  script:
  """
  echo Hello world!
  """
}

workflow {
  sayHello | view
}
```

The shell command is executed alongside the task script. Until now, you would typically execute these supplementary commands in the main process script, save the output to a file or environment variable, and then capture it using a `path` or `env` output. The `eval` output is a much more convenient way to capture this kind of command output directly.

See {ref}`process-out-eval` for details.

### Resource limits

The `resourceLimits` process directive allows you to define global limits on the resources requested by individual tasks. For example, if you know that the largest node in your compute environment has 24 CPUs, 768 GB of memory, and a maximum walltime of 72 hours, you might specify the following:

```groovy
process.resourceLimits = [ cpus: 24, memory: 768.GB, time: 72.h ]
```

If a task requests more than the specified limit (e.g. due to {ref}`retry with dynamic resources <dynamic-task-resources>`), Nextflow will automatically reduce the task resources to satisfy the limit, whereas normally the task would be rejected by the scheduler or would simply wait in the queue forever.

See {ref}`process-resourcelimits` for details.

### Job arrays

The `array` directive allows a process to submit jobs as "job arrays", which are supported by many batch schedulers as a way to submit many similar jobs in an efficient way:

```groovy
process.array = 100
```

:::{tip}
On Google Batch, the `array` directive can be used in conjunction with the `cpus`, `memory`, and `machineType` directives to pack multiple tasks onto the same VM.
:::

See {ref}`process-array` for details.

### Workflow outputs (first preview)

Workflow outputs are a new way to publish outputs at the workflow level:

```nextflow
nextflow.preview.output = true

workflow {
  main:
  ch_foo = foo(data)
  bar(ch_foo)

  publish:
  ch_foo >> 'foo'
}

output {
  directory 'results'
  mode 'copy'
}
```

It allows you to publish channels in a workflow, instead of publishing file patterns in a process using `publishDir`.

See {ref}`workflow-output-def` for details.

## Enhancements

### Colored logs

Nextflow's console output now features colored logs and improved organization to highglight the most important information about a pipeline while its running.

### AWS Fargate

Nextflow now supports AWS Fargate for AWS Batch jobs. See {ref}`aws-fargate` for details.

### OCI auto-pull mode for Singularity and Apptainer

The `singularity.ociAutoPull` (`apptainer.ociAutoPull`) config option enables OCI auto-pull mode for Singularity (Apptainer):

```groovy
singularity.ociAutoPull = true
```

This setting allows Singularity (Apptainer) to download and convert a Docker image during the task execution instead of the Nextflow head node.

See {ref}`config-singularity` and {ref}`config-apptainer` for details.

### GA4GH TES 1.1

The TES executor has been updated to be compliant with version 1.1 of the [TES API specification](https://ga4gh.github.io/task-execution-schemas/docs/). Notable improvements include support for directory outputs, glob outputs, and the `bin` directory.

You can use the TES executor with the following configuration:

```groovy
plugins {
  id 'nf-ga4gh'
}

process.executor = 'tes'
tes.endpoint = '...'
```

:::{note}
The nf-ga4gh plugin has since been moved into its own repository, [nextflow-io/nf-ga4gh](https://github.com/nextflow-io/nf-ga4gh). Refer to this repository for documentation and the latest updates on GA4GH integrations for Nextflow.
:::

## Deprecations and removals

- Support for {ref}`Glacier auto-retrieval <config-aws>` was removed. Consider using the AWS CLI to restore Glacier objects before or at the beginning of your pipeline.

- The `seqera` and `defaults` channels were removed from the default list of Conda channels used by Wave. They can be restored using the following setting:
  ```groovy
  conda.channels = ['seqera', 'conda-forge', 'bioconda', 'defaults']
  ```

## Miscellanous

- New config option: `azure.batch.pools.<name>.lowPriority`
- New config option: `azure.batch.pools.<name>.startTask.script`
- New config option: `azure.batch.pools.<name>.startTask.privileged`
- New config option: `executor.account`
- New config option: `fusion.cacheSize`
- New config option: `google.batch.maxSpotAttempts`
- New config option: `k8s.cpuLimits`
- New config option: `k8s.fuseDevicePlugin`
- New environment variable: `NXF_CLOUDINFO_ENABLED`
- New environment variable: `NXF_CACHE_DIR`
- New plugin extension point: `TaskTipProvider`
- New `pod` directive option: `schedulerName` 
- New `pod` directive option: `ttlSecondsAfterFinished` 
- New workflow metadata: `workflow.fusion.enabled`
- New workflow metadata: `workflow.fusion.version`
- New workflow metadata: `workflow.preview`
- New workflow metadata: `workflow.wave.enabled`
- Support for Google Batch {ref}`instance templates <google-batch-process>`
- Support the use of {ref}`secrets in the pipeline script <secrets-pipeline-script>`
- Upgrade to Groovy 4
