set -e

#
# Test that multi-process script automatically runs the first process
#
echo ''
echo '=== Testing multi-process auto-execution (first process) ==='
$NXF_RUN --inputFile "../../data/sample_data.txt" --quality "high" | tee stdout_auto

# Should run the first process (preprocessData) automatically
[[ `grep 'INFO' .nextflow.log | grep -c 'Submitted process > preprocessData'` == 1 ]] || false
[[ `grep -c 'Multi-process test: preprocessing' stdout_auto` == 1 ]] || false
[[ `grep -c 'Input file: sample_data.txt' stdout_auto` == 1 ]] || false
[[ `grep -c 'Quality threshold: high' stdout_auto` == 1 ]] || false
[[ `grep -c 'Preprocessing sample_data.txt with quality high' stdout_auto` == 1 ]] || false
[[ `grep -c 'Preprocessing completed' stdout_auto` == 1 ]] || false

# Check that first 5 lines of file were processed (head -n 5)
[[ `grep -c 'Line 1: Sample data' stdout_auto` == 1 ]] || false
[[ `grep -c 'Line 5: End of sample data' stdout_auto` == 1 ]] || false

#
# Test that the first process runs by default, others are ignored
# Note: This simplified implementation only runs the first process (preprocessData)
# Other processes in the script are ignored unless explicitly called via workflows
#
echo ''
echo '=== Confirming only first process runs by default ==='
echo 'Multi-process scripts now automatically run the first process only'