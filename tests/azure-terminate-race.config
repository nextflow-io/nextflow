/*
 * Config for azure-terminate-race.nf
 *
 * Uses a single Standard_D4a_v4 node (4 CPUs = 4 task slots).
 * With 50 fast tasks and 20 slow tasks (each requesting 1 CPU),
 * this forces heavy queuing to test onAllTasksComplete behaviour.
 *
 * Required environment variables:
 *   AZURE_BATCH_ACCOUNT_NAME
 *   AZURE_BATCH_ACCOUNT_KEY
 *   AZURE_STORAGE_ACCOUNT_NAME
 *   AZURE_STORAGE_ACCOUNT_KEY
 *
 * Usage:
 *   NXF_DEBUG=2 ./launch.sh run tests/azure-terminate-race.nf \
 *     -c tests/azure-terminate-race.config \
 *     -w az://<your-container>/work
 */

process {
    executor = 'azurebatch'
    container = 'ubuntu:22.04'
    queue = 'terminate-race-pool'
}

azure {
    batch {
        location = 'eastus'
        allowPoolCreation = true
        terminateJobsOnCompletion = true

        pools {
            'terminate-race-pool' {
                vmType = 'Standard_D2s_v3'
                vmCount = 1
                autoScale = false
                publisher = 'microsoft-dsvm'
                offer = 'ubuntu-hpc'
                sku = 'batch.node.ubuntu 24.04'
            }
        }
    }
}
